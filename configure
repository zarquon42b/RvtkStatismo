#! /bin/sh
# obtain and export Rs environment variables
export R_HOME
CXX=$($R_HOME/bin/R CMD config CXX)
#CXXFLAGS="$(R CMD config CXX1XSTD) $(R CMD config CXX1XFLAGS)"
CXXFLAGS=$($R_HOME/bin/R CMD config CXX1XFLAGS)
# $(R CMD config DYLIB_LDFLAGS)"
CPPFLAGS=$($R_HOME/bin/R CMD config CPPFLAGS)
BLAS_LIBS=$($R_HOME/bin/R CMD config BLAS_LIBS)
LAPACK_LIBS=$($R_HOME/bin/R CMD config LAPACK_LIBS)
export CXX
export CXXFLAGS
export CPPFLAGS
export BLAS_LIBS
export LAPACK_LIBS
export R_INCLUDE_DIR
## get OpenMP flags
MAKECONFFILE=$(Rscript -e 'cat(file.path(R.home("etc"), "Makeconf"))')
SHLIB_OPENMP_CXXFLAGS=$(grep 'SHLIB_OPENMP_CXXFLAGS' $MAKECONFFILE | sed 's/^.*= //')

export SHLIB_OPENMP_CXXFLAGS

RCPP_DIR=$($R_HOME/bin/Rscript -e "cat(system.file(package='Rcpp'))")
RCPPEIGEN_DIR=$($R_HOME/bin/Rscript -e "cat(system.file(package='RcppEigen'))")
export RCPP_DIR
export RCPPEIGEN_DIR
cd src

#cmake .
cmake . $@
#make -j$(grep -c ^processor /proc/cpuinfo)
